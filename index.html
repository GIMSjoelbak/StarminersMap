<!DOCTYPE html>
<html lang ="en">
<head>
<meta http-equiv="Access-Control-Allow-Origin" content="*" />
  <base target="_top">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <style>
body {
      padding: 0;
      margin: 0;
    }
html, body, #map {
      height: 100%;
      width: 100%;
    }
/* Make the table cells have padding */
table {
  border-collapse: collapse;
  width: 100%;
}

td {
  padding: 3px;
font-size: 12px;
border: 1px solid black;
}

/* Set a fixed width for the table cells */
th, td {
  width: 20%;
  max-width: 250px;
}

/* Prevent text from wrapping */
td {
  white-space: nowrap;
  overflow: hidden;
}
td:last-child {
  width: 30%;
}
.leaflet-popup-content-wrapper {
  width: auto !important;
  max-width: 100% !important;
}
  </style>
  </head>
  <body>	  			
    <div id="map"</div>
	  <script src="coordinates.js"></script>
	  	  <script>
		  var polygon1 = L.polygon([
			  [1300,4855],
			  [1215,4890],
			  [1200,5530],
			  [1855,5410],
			  [2020,5425],
			  [2130,5190],
			  [2430,5180],
			  [2485,5145],
			  [2470,5085],
			  [2292,4810],
			  [2190,4705],
			  [2020,4695],
			  [1960,4805],
			  [1915,4840]
			  ], {
			   fillColor: '#ff0000', // set the fill color to red
  fillOpacity: 0.5, // set the fill opacity to 50%
  weight: 2, // set the border weight to 2 pixels
  color: '#000000' // set the border color to black
		  }).addTo(map);
		  
		  var polygon2 = L.polygon([
			  [1582,4502],
			  [1565,2965],
			  [1420,2865],
			  [1135,2838],
			  [900,3065],
			  [855,3280],
			  [1107,4394],
			  [1435,4550],
			  [1550,4538]
			  ]).addTo(map);
 // Define a function to create the table content
function createTableContent(data) {
  var tableContent = "<thead><tr><th>Location</th><th>World</th><th>Min Time</th><th>Max Time</th><th>Called Location</th></tr></thead><tbody>";
  for (var i = 0; i < data.length; i++) {
    tableContent += "<tr><td>" + data[i].location + "</td><td>" + data[i].world + "</td><td>" + data[i].minTime + "</td><td>" + data[i].maxTime + "</td><td>" + data[i].calledLocation + "</td></tr>";
  }
  tableContent += "</tbody>";
  return tableContent;
}

// Define a function to update the popup content
function updatePopupContent(popup, url) {
  // Send a GET request to the URL
  fetch(url)
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      // Filter the data by location
      var filteredData = data.filter(function(d) {
        return d.location === currentLocation;
      });
      // Create the table content
      var tableContent = createTableContent(filteredData);
      // Check if the table content has changed from previous
      var prevTableContent = popup.getContent();
      if (tableContent !== prevTableContent) {
        // Set the popup content with new table content
        popup.setContent(tableContent);
        // Flash the polygon
        polygon.setStyle({fillColor: "red"});
        setTimeout(function() {
          polygon.setStyle({fillColor: "blue"});
        }, 500);
      }
    });
}

// Define the popup options
var popupOptions = {
  maxHeight: 200,
  maxWidth: 300
};

// Define a variable to store the current location
var currentLocation;

// Add the click event listeners to the polygons
polygon1.on('click', function(e) {
  currentLocation = 1;
  updatePopupContent(this.getPopup(), 'stars.json');
});

polygon2.on('click', function(e) {
  currentLocation = 2;
  updatePopupContent(this.getPopup(), 'stars.json');
});
			  // Call the updatePopupContent function every minute
setInterval(function() {
  polygon1.getPopup().update();
  polygon2.getPopup().update();
  // ... update the rest of the popups
}, 60000);

// ... add the click event listeners to the rest of the polygons
	  </script>
  </body>
 </html>
  
      
  
